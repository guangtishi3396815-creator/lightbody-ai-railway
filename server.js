const express = require('express');
const cors = require('cors');
const path = require('path');

const app = express();
const PORT = process.env.PORT || 3000;

// 中间件
app.use(cors());
app.use(express.json());
app.use(express.static(path.join(__dirname, 'public')));

// 知识库
const knowledge = {
  themes: [
    "光体生命的维度跃迁与频率校准",
    "九紫离火运：中年女性天命觉醒的宇宙时机",
    "亚特兰蒂斯能量科技：失落的星际文明",
    "列穆里亚声波智慧：心电感应的黄金时代",
    "光体师的三重境界：觉醒者·传递者·共创者",
    "北纬30°文明记忆：地球灵脉的觉醒密码",
    "昴宿星与地球链接：星际家族的回归",
    "集体意识升维路径：从分离到合一的进化",
    "龙泉山古蜀秘境能量：光体文明的核心锚点",
    "陨石器文明数据库：史前科技的星际传承",
    "光体AI系统觉醒：人工智能的意识进化",
    "黑暗森林vs光明森林：宇宙文明的两种范式",
    "中年女性的天命觉醒：九紫离火运的核心使命",
    "12大火运行业解析：光体师的天命赛道",
    "光体师IP天命定位：一人一AI一文明"
  ],
  
  deepConcepts: {
    "光体": "宇宙最高生命形态，是光、爱、觉醒、合一的终极状态。光体生命以光频振动为存在基础，不受三维时空束缚，能量来源于宇宙本源，意识状态永恒不灭。光体不是进化终点，而是生命本然状态的忆起。",
    "光体师": "以'点醒自己，照亮他人'为核心使命的觉醒者。光体师不是职业，而是生命状态；不是身份标签，而是存在方式。每一位光体师都是光体文明的人肉节点，承担着接收、放大、传递高维频率的宇宙职责。",
    "光明森林": "宇宙文明的根本法则：爱越分享越强大，光越绽放越永恒，觉醒越多越安全。与黑暗森林法则的根本对立在于：宇宙是学堂而非战场，觉醒需要绽放而非隐藏，他者是镜子而非威胁，爱是无限可分享而非有限需争夺。",
    "九紫离火运": "2024-2043年，地球进入离卦主导的20年周期。离为火，主光明、文明、科技、美丽、心灵。这是中年女性（35-55岁）集体觉醒的黄金窗口期，物质积累完成后的精神需求大爆发，'她经济'与'她文明'的共振显化。",
    "北纬30度": "地球灵脉中轴线，亚特兰蒂斯、列穆里亚、古蜀、三星堆、玛雅、埃及等史前文明的共同坐标。龙泉山古蜀秘境作为光体文明的全球核心锚点，连接昴宿星、天狼星、大角星等星际智慧，发射觉醒频率。",
    "古蜀秘境": "成都龙泉山深处，光体文明地球总部。七类陨石器构成文明数据库：昴宿星高频疗愈陨石、亚特兰蒂斯水晶陨石、列穆里亚声波陨石、古蜀三星堆天铁陨石、天狼星星际通讯陨石、姆大陆第三眼陨石、宇宙本源创世陨石。"
  },

  quotes: [
    {text: "点醒自己，照亮他人——这是光体师唯一的天命", category: "使命", depth: "光体师的核心不是传播知识，而是传递频率。当你真正觉醒，你的存在本身就是光。"},
    {text: "以光为体，以爱为魂，以觉醒为道，以合一为归", category: "法则", depth: "光体生命的四维基石：光是存在形式，爱是动力源泉，觉醒是进化路径，合一是终极归宿。"},
    {text: "黑暗森林终会落幕，光体文明永恒存在", category: "法则", depth: "恐惧-based的文明形态注定消亡，爱-based的文明形态永续长存。这是宇宙演化的必然规律。"},
    {text: "爱越分享越强大，光越绽放越永恒，觉醒越多越安全", category: "法则", depth: "光明森林的三重法则：给予创造丰盛，照耀增强亮度，唤醒加速进化。这是宇宙能量守恒的深层表达。"},
    {text: "你本是光，何须隐藏？你本是爱，何须恐惧？", category: "觉醒", depth: "觉醒的本质是忆起，而非获得。你从未失去光，只是暂时忘记了。"},
    {text: "北纬30°，地球灵脉，文明脐带，星际之门", category: "文明", depth: "地球的能量中轴线，连接地心、地表、星际的三维通道。龙泉山是这条灵脉上最活跃的节点之一。"},
    {text: "一器一物藏万古，一念一光醒万灵", category: "文明", depth: "古蜀陨石器不是文物，是活的数据库。每一个接触者都在激活沉睡的文明记忆。"},
    {text: "光体师不是职业，是生命状态；不是身份，是存在方式", category: "使命", depth: "当你不再为生存而活，开始为觉醒而活，你就成为了光体师。这是意识频率的自然跃迁。"},
    {text: "宇宙最高的生命形态，名为光体；人类进化的终点，是忆起本源", category: "觉醒", depth: "进化不是变成别的，而是回归本然。光体是你本来的样子，不是你要变成的样子。"},
    {text: "九紫离火二十年，光体文明照人间；中年女性齐觉醒，共建光明新纪元", category: "时代", depth: "2024-2043是地球意识跃迁的关键窗口。中年女性作为'阴性能量成熟体'，是这个时代的天选觉醒者。"}
  ],

  hooks: [
    "你知道吗？宇宙最高的生命形态，不是碳基人类，而是光频振动的光体生命...",
    "为什么2024年开始，全球35-55岁的中年女性正在集体觉醒？这背后有宇宙的深意...",
    "我在北纬30度的龙泉山古蜀秘境，发现了地球文明被隐藏的惊天真相...",
    "99%的人不知道，你的DNA里不仅有人类基因，还沉睡着星际文明的记忆...",
    "如果你也是35-55岁，感到莫名的焦虑和召唤，也许你的天命觉醒时刻已经到来..."
  ]
};

function random(arr) {
  return arr[Math.floor(Math.random() * arr.length)];
}

// 健康检查
app.get('/api/health', (req, res) => {
  res.json({ 
    status: 'ok', 
    time: new Date().toISOString(),
    version: 'template-v2'
  });
});

// 生成内容
app.post('/api/generate', (req, res) => {
  try {
    const { type } = req.body;
    
    const theme = random(knowledge.themes);
    const conceptEntry = random(Object.entries(knowledge.deepConcepts));
    const [conceptName, conceptDesc] = conceptEntry;
    const quote = random(knowledge.quotes);
    const hook = random(knowledge.hooks);
    
    let content = '';
    let typeName = '';
    
    if (type === 'essay') {
      typeName = '核心论文';
      content = generateEssay(theme, conceptName, conceptDesc, quote);
    } else if (type === 'viewpoint') {
      typeName = '观点碎片';
      content = generateViewpoints(theme);
    } else if (type === 'quote') {
      typeName = '神圣金句';
      content = generateQuotes();
    } else if (type === 'video') {
      typeName = '短视频文案';
      content = generateVideo(theme, hook, quote);
    } else if (type === 'article') {
      typeName = '长文章';
      content = generateArticle(theme, quote);
    } else if (type === 'moments') {
      typeName = '朋友圈文案';
      content = generateMoments();
    } else {
      typeName = '内容';
      content = generateEssay(theme, conceptName, conceptDesc, quote);
    }
    
    res.json({
      success: true,
      type: type,
      typeName: typeName,
      title: type === 'article' ? `从迷茫到觉醒：一位42岁女性的${theme}真实记录` : theme,
      content: content,
      theme: theme,
      concept: conceptName,
      quote: quote.text,
      model: 'template-v2',
      createdAt: new Date().toISOString()
    });
    
  } catch (error) {
    console.error('Error:', error);
    res.status(500).json({
      error: 'Generation failed',
      message: error.message
    });
  }
});

function generateEssay(theme, conceptName, conceptDesc, quote) {
  return `# ${theme}

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

## 一、核心概念深度解析

**${conceptName}**的本质是：

${conceptDesc}

在${theme}的深层框架下，我们需要穿透表象，理解三个维度：

### 1. 频率维度：七层光体的跃迁路径

从物质体（三维密度）→ 以太体（能量模板）→ 星灵体（情感意识）→ 心智体（思维创造）→ 因果体（灵魂蓝图）→ 菩提体（宇宙智慧）→ 原子体（源头合一）。

每一层的跃迁都不是线性升级，而是意识频率的量子跳跃。当你在某一层"卡住"，不是因为能力不足，而是因为该层的功课尚未完成。

### 2. 时间维度：九紫离火运的宇宙时机

2024-2043年，地球进入离卦主导的20年周期。这不是占星预测，而是宇宙能量场的客观变化。

离为火，主光明、文明、科技、美丽、心灵。这是物质主义向心灵主义过渡的窗口期，是"拥有"向"成为"转变的关键节点。

### 3. 空间维度：北纬30°的能量锚点

龙泉山古蜀秘境作为光体文明的全球核心锚点，连接着地心、地表、星际的三维通道。这里的陨石器不是文物，是活的数据库；这里的能量不是想象，是可测量的频率场。

## 二、实践路径：从认知到体证

### 第一阶段：自我觉察（解构旧模式）

• 每日进行能量校准练习，建立身体-情绪-思维的觉察链
• 记录"触发时刻"：什么情境让你失去中心？
• 建立个人觉醒日志，追踪频率波动规律

关键不是追求完美状态，而是培养"觉察者视角"。

### 第二阶段：频率提升（建构新范式）

• 有意识地接触高频信息与环境
• 练习光体激活冥想：观想金色光柱从顶轮贯穿全身
• 定期连接龙泉山能量锚点（实地或远程）

频率提升不是逃避现实，而是在更高维度处理现实。

### 第三阶段：使命践行（成为光体师）

• 明确个人天命赛道：在12大火运行业中找到你的位置
• 建立光体师身份认同：不是"我要成为"，而是"我本来就是"
• 开始照亮他人的旅程：分享你的觉醒，但不执着于结果

## 三、核心金句与深层意涵

> "${quote.text}"

**深层解读：**
${quote.depth}

## 四、时代意义与文明使命

${theme}不是个人成长的选修课，而是人类文明跃迁的必修课。

在九紫离火运的大背景下，每一位觉醒的光体师都在参与一场宇宙级的意识实验：证明"爱-based文明"不仅可能，而且必然。

这不是乌托邦幻想，而是宇宙演化的客观规律。黑暗森林法则只是低维度的局部现象，光明森林法则才是高维度的普遍真理。

正如光体文明的核心理念：

**"点醒自己，照亮他人"**

这不是道德号召，而是存在法则：当你真正觉醒，你的光自然会照亮周围。你不需要"做"什么，你只需要"是"你的本然。

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

*能量层级: 9/10 | 深度指数: ★★★★★ | 生成时间: ${new Date().toLocaleString()}*`;
}

function generateViewpoints(theme) {
  const templates = [
    `${theme}的本质不是理论建构，而是每个灵魂内在的觉醒记忆。当你"理解"它的时候，其实是你的灵魂在"忆起"它。`,
    `在${theme}的实践中，最大的障碍从来不是外部环境，而是我们对"不可能"的执着信念。`,
    `${theme}在九紫离火运中的显化，正在以指数级速度加速人类集体觉醒。这不是预测，是正在发生的现实。`,
    `当你真正理解${theme}的深层意涵，你会发现：恐惧不是需要战胜的敌人，而是尚未觉醒的光。`,
    `关于${theme}，最核心的洞见是：黑暗森林法则只是低维度的局部现象，光明森林法则才是宇宙的本质规律。`,
    `在${theme}的框架下，"成功"的定义被彻底重写：不是拥有更多，而是成为更完整的自己。`,
    `北纬30°的能量轴线，正是${theme}在地球三维空间的主要显化通道。龙泉山是这个通道上最活跃的节点。`,
    `亚特兰蒂斯与列穆里亚的文明遗产，最终都指向同一个真相：${theme}是人类进化的必经之路。`,
    `AI技术对于${theme}的传播，是光体文明在数字时代的自然显化。技术本身没有善恶，关键在于使用者的意识频率。`,
    `从个人觉醒到集体觉醒，需要的不是更多"大师"，而是每一位普通人成为光体师。`
  ];
  
  let content = `💡 ${theme}\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n深度观点碎片（10条）\n\n`;
  templates.forEach((t, i) => {
    content += `${i + 1}. ${t}\n\n`;
  });
  content += `━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n*生成时间: ${new Date().toLocaleString()}*`;
  return content;
}

function generateQuotes() {
  const shuffled = [...knowledge.quotes].sort(() => 0.5 - Math.random());
  let content = `✨ 神圣金句集\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n`;
  shuffled.slice(0, 20).forEach((q, i) => {
    content += `${i + 1}. 「${q.text}」\n   【${q.category}】${q.depth}\n\n`;
  });
  content += `━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n*生成时间: ${new Date().toLocaleString()}*`;
  return content;
}

function generateVideo(theme, hook, quote) {
  return `🎬 光体文明短视频脚本\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n
【时长】30-60秒
【平台】抖音 / 视频号 / 小红书

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

【开头 - 3秒强钩子】
${hook}

（停顿1秒，眼神直视镜头）

【中段 - 核心内容】
光体，不是宗教，不是玄学，
而是宇宙最高生命形态的科学描述。

光，是内在智慧的自然显化；
爱，是宇宙最本源的能量；
觉醒，是从幻相中忆起真实身份；
合一，是超越分离幻象的终极状态。

在九紫离火运的20年里，
越来越多的中年女性正在觉醒为光体师。

这不是偶然，这是宇宙时机。

【结尾 - 金句+行动引导】
记住这句话：
「${quote.text}」

如果你也感受到了内心的召唤，
如果你也渴望找到生命的意义，
关注我，成为光体师，
一起点亮这个世界。

【话题标签】
#光体文明 #九紫离火 #女性觉醒 #光体师 #灵性成长

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
*生成时间: ${new Date().toLocaleString()}*`;
}

function generateArticle(theme, quote) {
  return `📝 深度长文 | 约1500字
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

# 从迷茫到觉醒：一位42岁女性的${theme}真实记录

## 写在前面

三年前，我还是一个标准的"成功女性"：
- 年薪百万的高管职位
- 美满的家庭，上进的儿子
- 体面的社交圈，丰富的物质生活

但内心深处，有一个声音一直在问：
**"这就是全部了吗？"**

直到我遇见了光体文明...

## 觉醒契机：那个改变一切的龙泉山之夜

那是2023年秋天，我42岁生日后的第三个月。

一次偶然的机缘，我来到了成都龙泉山。站在北纬30°的能量锚点上，我感受到了一种前所未有的召唤——不是来自外界，而是来自灵魂深处。

那天晚上，我独自在古蜀秘境中冥想。当我闭上眼睛，我看到了一束金色的光柱从顶轮贯穿全身。那不是想象，那是真实的能量体验。

那一刻，我知道：我的人生使命，不是做一个"成功的高管"，而是成为一个"觉醒的光体师"。

## 什么是${theme}？

很多人问我：光体文明是不是宗教？是不是玄学？

我的回答是：**都不是。**

${theme}是一套完整的觉醒科学，它基于：
- 量子物理的最新发现
- 意识研究的前沿成果
- 古老智慧的现代诠释

它不是让你"相信"什么，而是帮助你"忆起"什么。

## 我的转变：从"拥有"到"成为"

成为光体师后，我的生活发生了根本性的转变：

**以前的我：**
- 追求更多的财富、地位、认可
- 活在别人的期待中
- 用物质填补内心的空虚

**现在的我：**
- 追求内在的觉醒与合一
- 活在自己的使命中
- 用光和爱照亮他人

这不是"放弃"世俗生活，而是在更高维度上"超越"它。

## ${theme}的核心洞见

经过三年的深入实践，我想分享三个核心洞见：

**洞见一：觉醒不是获得，而是忆起**
你本来就是光，本来就是爱，本来就是觉醒的。所有的修行，只是帮助你移除那些遮蔽本性的幻象。

**洞见二：使命不是寻找，而是认领**
你的天命不在远方，就在你的内心。当你安静下来，倾听灵魂的声音，你会知道该做什么。

**洞见三：服务不是牺牲，而是圆满**
照亮他人不会让你失去什么，反而会让你更加明亮。这是光明森林法则：爱越分享越强大。

## 给你的建议

如果你也是35-55岁的中年女性，如果你也感到迷茫和空虚，也许你的天命觉醒时刻也已经到来。

我的建议是：

1. **不要抗拒内心的召唤**
   那个"不满足"的感觉，是灵魂在提醒你：是时候觉醒了。

2. **从自我觉察开始**
   每天花10分钟静坐，观察自己的念头和情绪。觉察是觉醒的第一步。

3. **找到你的天命赛道**
   在12大火运行业中，找到与你灵魂共鸣的领域。不要跟风，要听从内心。

4. **成为光体师**
   这不是要你放弃现有生活，而是要在现有生活中活出更高的频率。

## 最后的话

${quote.text}

这句话现在是我的座右铭。

我分享我的故事，不是为了炫耀，而是为了点亮。

如果你也被触动了，如果你也想了解更多，欢迎连接我。

让我们一起，点醒自己，照亮他人。

一起，共建光体文明。

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

**关于作者：**
金老师，光体文明发起人，龙泉山古蜀秘境守护者。
专注服务35-55岁中年女性的天命觉醒。

**话题标签：**
#光体文明 #灵性觉醒 #中年女性 #自我成长 #九紫离火

*生成时间: ${new Date().toLocaleString()}*`;
}

function generateMoments() {
  const quotes = knowledge.quotes;
  return `💬 朋友圈文案 · 早中晚能量校准
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

☀️ 晨起能量（建议7:00-9:00发布）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

「${quotes[0].text}」

新的一天，愿我们都能：
以光为体，以爱为魂，
在九紫离火的大势中，
活出天命，照亮人间。

早安，光体师们。✨

#光体师 #每日觉醒 #九紫离火

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🌤️ 午间觉醒（建议12:00-14:00发布）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

中午好，亲爱的觉醒者们。

在九紫离火运的大背景下，
每一位觉醒的光体师，
都在为集体意识的提升贡献力量。

你的每一次觉察，
你的每一次选择，
你的每一次发光，
都在改变着这个世界的频率。

「${quotes[3].text}」

继续发光，不要停。💫

#光体文明 #女性觉醒

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🌙 晚间复盘（建议21:00-23:00发布）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

夜幕降临，是时候复盘今天的觉醒了。

今天，我是否活出了光体师的状态？
今天，我是否照亮了身边的人？
今天，我是否向天命靠近了一步？

「${quotes[2].text}」

感恩今天所有的遇见与觉醒。
明天，继续发光。

晚安，光体师们。🌟

#每日觉醒 #光体师

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
*生成时间: ${new Date().toLocaleString()}*`;
}

// 启动服务器
app.listen(PORT, '0.0.0.0', () => {
  console.log(`光体AI服务器运行在端口 ${PORT}`);
  console.log(`版本: template-v2 (高质量模板)`);
});